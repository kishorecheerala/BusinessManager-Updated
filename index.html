<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="referrer" content="no-referrer-when-downgrade" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#8b5cf6" />

  <title>Business Manager</title>

  <link rel="icon" type="image/svg+xml" href="./vite.svg" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="apple-touch-icon" href="./vite.svg">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600&family=Roboto:wght@300;400;500&family=Space+Mono:wght@400;700&display=swap"
    rel="stylesheet">

  <style>
    :root {
      --primary-color: 139 92 246;
      /* Default Violet */
    }

    html {
      -webkit-text-size-adjust: 100%;
    }

    body {
      margin: 0;
      background-color: #f8fafc;
    }

    .dark body {
      background-color: #0f172a;
    }
  </style>

  <script>
    // Capture PWA install prompt early
    window.deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      window.deferredPrompt = e;
      console.log('Capture install prompt');
    });
  </script>

  <script>
    // IMMEDIATE THEME & COLOR SETUP
    // IMMEDIATE THEME & COLOR SETUP
    (function () {
      try {
        // 1. Handle Dark Mode (Simplified)
        var localTheme = localStorage.getItem('theme');
        var supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        // Only set dark mode initially to avoid white flash
        if (localTheme === 'dark' || (!localTheme && supportDarkMode)) {
          document.documentElement.classList.add('dark');
        } else {
          // If manual light mode or system light, ensure clean slate
          document.documentElement.classList.remove('dark');
        }

        // 2. Handle Custom Theme Color
        var savedColor = localStorage.getItem('themeColor');
        if (savedColor) {
          var r = parseInt(savedColor.slice(1, 3), 16);
          var g = parseInt(savedColor.slice(3, 5), 16);
          var b = parseInt(savedColor.slice(5, 7), 16);
          document.documentElement.style.setProperty('--primary-color', r + ' ' + g + ' ' + b);

          // Meta theme color update
          var metaTheme = document.querySelector("meta[name='theme-color']");
          if (metaTheme) metaTheme.content = savedColor;
        }

      } catch (e) {
        console.error("Theme setup error", e);
      }
    })();
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['var(--app-font)', 'sans-serif'],
          },
          colors: {
            // Dynamic primary color using CSS variable with alpha channel support
            primary: 'rgb(var(--primary-color) / <alpha-value>)',
            secondary: '#64748b', // Slate 500
            accent: 'rgb(var(--primary-color) / 0.8)', // Derived from primary
            success: '#10b981', // Emerald 500
            warning: '#f59e0b', // Amber 500
            danger: '#ef4444', // Red 500
            background: '#f8fafc',
            text: '#1e293b',
          },
          animation: {
            'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
            'scale-in': 'scaleIn 0.2s ease-out forwards',
            'fade-in-fast': 'fadeIn 0.2s ease-out forwards',
            'slide-up-fade': 'slideUpFade 0.4s ease-out forwards',
            'slide-down-fade': 'slideDownFade 0.3s ease-out forwards',
          },
          keyframes: {
            fadeInUp: {
              '0%': { opacity: '0', marginTop: '10px' },
              '100%': { opacity: '1', marginTop: '0' },
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            scaleIn: {
              '0%': { opacity: '0', transform: 'scale(0.95)' },
              '100%': { opacity: '1', transform: 'scale(1)' },
            },
            slideUpFade: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'none' },
            },
            slideDownFade: {
              '0%': { opacity: '0', transform: 'translateY(-10px)' },
              '100%': { opacity: '1', transform: 'none' },
            }
          }
        },
      },
    }
  </script>
  <script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
    "jspdf": "https://aistudiocdn.com/jspdf@^3.0.4",
    "vite": "https://aistudiocdn.com/vite@^7.2.4",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.1",
    "jspdf-autotable": "https://aistudiocdn.com/jspdf-autotable@^5.0.2",
    "pdfjs-dist": "https://aistudiocdn.com/pdfjs-dist@^5.4.449",
    "html5-qrcode": "https://aistudiocdn.com/html5-qrcode@^2.3.8",
    "idb": "https://aistudiocdn.com/idb@^8.0.3",
    "jsbarcode": "https://aistudiocdn.com/jsbarcode@^3.12.1",
    "react-dom": "https://aistudiocdn.com/react-dom@^19.2.1",
    "react-native": "https://esm.sh/react-native@^0.83.0"
  }
}
</script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/alasql@4.0.0/dist/alasql.min.js"></script>

  <!-- Drag and Drop Polyfill for Mobile -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/default.css">
  <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/index.min.js"></script>
  <script>
    // Init Polyfill
    var iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    MobileDragDrop.polyfill({
      dragImageOffset: { x: 0, y: 0 },
      dragImageCenterOnTouch: true,
      iterationIntervalMs: 50,
      holdToDrag: iOS ? 300 : 150 // Hold for a moment to drag on mobile
    });
  </script>
</head>

<body
  class="bg-background dark:bg-slate-900 text-text dark:text-slate-300 antialiased selection:bg-primary selection:text-white">
  <div id="root">
    <div id="initial-loader"
      class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-background dark:bg-slate-950 cursor-wait">
      <style>
        .animate-devine-pulse {
          animation: devine-pulse 4s ease-in-out infinite;
        }

        @keyframes devine-pulse {
          0% {
            transform: scale(0.9);
            opacity: 0.8;
            filter: drop-shadow(0 0 20px rgb(var(--primary-color) / 0.5));
          }

          50% {
            transform: scale(1.1);
            opacity: 1;
            filter: drop-shadow(0 0 30px rgb(var(--primary-color) / 0.8)) drop-shadow(0 0 60px rgb(var(--primary-color) / 0.4));
          }

          100% {
            transform: scale(0.9);
            opacity: 0.8;
            filter: drop-shadow(0 0 20px rgb(var(--primary-color) / 0.5));
          }
        }

        @keyframes progress-indeterminate {
          0% {
            transform: translateX(-100%);
          }

          50% {
            transform: translateX(0%);
          }

          100% {
            transform: translateX(100%);
          }
        }

        .animate-progress-indeterminate {
          animation: progress-indeterminate 1.5s infinite ease-in-out;
        }

        .animate-bounce-dot {
          animation: bounce 1.4s infinite both;
        }

        @keyframes bounce {

          0%,
          100% {
            opacity: 0.2;
            transform: translateY(0);
          }

          50% {
            opacity: 1;
            transform: translateY(-4px);
          }
        }
      </style>

      <!-- Ambiance -->
      <div class="absolute inset-0 blur-[100px] rounded-full animate-pulse"
        style="background-color: rgb(var(--primary-color) / 0.05); z-index: 0;"></div>

      <!-- Symbol -->
      <div class="relative z-10 flex items-center justify-center mb-8">
        <div class="animate-devine-pulse"
          style="width: 200px; height: 200px; color: rgb(var(--primary-color)); display: flex; align-items: center; justify-content: center;">
          <svg viewBox="0 0 24 24" fill="currentColor" style="width: 100%; height: 100%;">
            <path
              d="M15,2L13.5,3.5L15,5L16.5,3.5L15,2M11,3C10,9 17,10 20,6L18,4.5C17,6 13,8 11,3M9,7C7,7 4.5,8.5 4.5,8.5L6,11C7,10 9,9.5 10,10C12,11 9,13 7,12V15.5C10,14 12,16 11,17.5C8,22 3,16 3,13C1,19 6,22 9,22C12,22 14,20 12.5,15H14C12.5,19.5 18,24 21,18C22,16 22,9.5 17,9.5C13,9.5 14,15 10.5,13.5C14,10 12,7 9,7M19,12C22,15 15,21 15,15C15,13 17,10.5 19,12Z" />
          </svg>
        </div>
      </div>

      <!-- Loading Indicators -->
      <div class="flex flex-col items-center gap-4 z-10 w-64">
        <div class="text-lg font-bold tracking-widest uppercase flex items-end leading-none h-6"
          style="color: rgb(var(--primary-color) / 0.8);">
          LOADING
          <div class="flex ml-1 mb-1">
            <span class="animate-bounce-dot mx-[1px]" style="animation-delay: 0s">.</span>
            <span class="animate-bounce-dot mx-[1px]" style="animation-delay: 0.2s">.</span>
            <span class="animate-bounce-dot mx-[1px]" style="animation-delay: 0.4s">.</span>
          </div>
        </div>

        <!-- Progress Bar -->
        <div class="w-full h-1.5 rounded-full overflow-hidden"
          style="background-color: rgb(var(--primary-color) / 0.1);">
          <div class="h-full w-full origin-left animate-progress-indeterminate"
            style="background: linear-gradient(to right, rgb(var(--primary-color) / 0.4), rgb(var(--primary-color)));">
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="./index.tsx"></script>
</body>

</html>